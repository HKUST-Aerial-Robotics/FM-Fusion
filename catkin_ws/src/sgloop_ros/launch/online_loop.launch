<launch>

  <!-- global settings  -->
  <arg name="dataroot" value="/data2/sgslam"/>
  <arg name="cfg_file" value="/home/cliuci/code_ws/OpensetFusion/config/realsense.yaml"/>
  <arg name="weights_folder" value="/home/cliuci/code_ws/OpensetFusion/torchscript"/>
  <arg name="loop_duration" value="25"/>
  <arg name="coarse_mode" value="false"/>
  <group ns="viz"> 
      <param name="edge_width" value="0.03"/>
      <param name="edge_color/r" value="0.0"/>
      <param name="edge_color/g" value="1.0"/>
      <param name="edge_color/b" value="1.0"/>
      <param name="centroid_size" value="0.3"/>
  </group>

  <!-- agent A,B -->
  <arg name="agentA_scene" value="uc0115_00a"/>
  <arg name="agentB_scene" value="uc0115_00b"/>
  <!-- position_b = position_a + offset -->
  <arg name="offset_x" value="0.0"/>
  <arg name="offset_y" value="0.0"/>
  <arg name="offset_z" value="3.0"/>

  <node pkg="sgloop_ros" name="agentA" type="OnlineLoop" output="screen">
    <param name="cfg_file" value="$(arg cfg_file)"/>
    <param name="weights_folder" value="$(arg weights_folder)"/>
    <param name="output_folder" value="$(arg dataroot)/output/online_loop"/>
    <param name="active_sequence_dir" value="$(arg dataroot)/scans/$(arg agentA_scene)"/>
    <param name="local_agent" value="agentA"/>
    <param name="remote_agent" value="agentB"/>    
    <param name="frame_gap" value="2"/>
    <param name="coarse_mode" value="$(arg coarse_mode)"/>
    <param name="loop_duration" value="$(arg loop_duration)"/>
    <param name="visualization" value="1"/>
    <!-- set to 0 to load reconstruted ref map, 1 to pub and subscribe ref map online -->
    <param name="mode" value="1"/>
    <param name="ref_scene_dir" value="$(arg dataroot)/val/$(arg agentB_scene)"/>
    <param name="debug_mode" value="false"/>

    <param name="viz/local_frame_offset/x" value="$(arg offset_x)"/>
    <param name="viz/local_frame_offset/y" value="$(arg offset_y)"/>
    <param name="viz/local_frame_offset/z" value="$(arg offset_z)"/>
  </node>

  <node pkg="sgloop_ros" name="agentB" type="OnlineLoop" output="screen">
    <param name="cfg_file" value="$(arg cfg_file)"/>
    <param name="weights_folder" value="$(arg weights_folder)"/>
    <param name="output_folder" value="$(arg dataroot)/output/online_loop"/>
    <param name="active_sequence_dir" value="$(arg dataroot)/scans/$(arg agentB_scene)"/>
    <param name="local_agent" value="agentB"/>
    <param name="remote_agent" value="agentC"/>    
    <param name="frame_gap" value="2"/>
    <param name="coarse_mode" value="$(arg coarse_mode)"/>
    <param name="loop_duration" value="$(arg loop_duration)"/>
    <param name="visualization" value="1"/>
    <param name="mode" value="1"/>
    <param name="ref_scene_dir" value="$(arg dataroot)/val/$(arg agentA_scene)"/>

    <param name="viz/local_frame_offset/x" value="-$(arg offset_x)"/>
    <param name="viz/local_frame_offset/y" value="-$(arg offset_y)"/>
    <param name="viz/local_frame_offset/z" value="-$(arg offset_z)"/>
  </node>

  <node pkg="tf" type="static_transform_publisher" name="link_before_loop" args="$(arg offset_x) $(arg offset_y) $(arg offset_z) 0 0 0 1 agentA agentB 100" />

</launch>
